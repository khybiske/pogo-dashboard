<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MachoMankey's PoGo Dashboard</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  background-attachment: fixed;
  padding: 8px;
  min-height: 100vh;
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding-bottom: 30px;
}

/* Header - Pokemon Go Style */
.header {
  background: linear-gradient(180deg, #3B7DDD 0%, #5089E0 50%, #FFFFFF 100%);
  border-radius: 16px;
  padding: 20px 15px 15px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(59, 125, 221, 0.4);
  margin-bottom: 15px;
  position: relative;
  border: 3px solid white;
}

.header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #EE1515 0%, #EE1515 33%, #FFFFFF 33%, #FFFFFF 66%, #3B7DDD 66%, #3B7DDD 100%);
}

.header h1 {
  color: white;
  font-size: 24px;
  margin-bottom: 8px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
  font-weight: 900;
  letter-spacing: 0.5px;
}

.trainer-info {
  color: rgba(255, 255, 255, 0.95);
  font-size: 15px;
  font-weight: 600;
  margin: 5px 0 8px;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

.trainer-level {
  color: #FFD700;
  font-weight: 700;
}

.status-badge {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 15px;
  font-size: 11px;
  font-weight: 700;
  margin-top: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  border: 2px solid white;
}

.status-connected { background: #48BB78; color: white; }
.status-disconnected { background: #F56565; color: white; }
.status-loading { background: #ECC94B; color: #2D3748; }

/* Sections */
.section {
  background: white;
  border-radius: 12px;
  padding: 0;
  margin-bottom: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.15);
  overflow: hidden;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 15px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  cursor: pointer;
  user-select: none;
}

.section-header h2 {
  color: white;
  font-size: 16px;
  margin: 0;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

.collapse-icon {
  color: white;
  font-size: 18px;
  transition: transform 0.3s;
}

.section-header.collapsed .collapse-icon {
  transform: rotate(-90deg);
}

.section-content {
  padding: 15px;
  display: block;
}

.section-content.collapsed {
  display: none;
}

/* AI Helper Box */
.ai-helper-box {
  background: linear-gradient(135deg, #FFF3CD 0%, #FFF8E1 100%);
  border: 2px solid #FFC107;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
}

.ai-helper-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  flex-wrap: wrap;
  gap: 10px;
}

.ai-helper-title {
  color: #856404;
  font-size: 15px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
}

.ai-helper-text {
  font-size: 13px;
  color: #856404;
  line-height: 1.6;
  margin-top: 8px;
}

.ai-helper-steps {
  margin-top: 12px;
  padding-left: 20px;
  font-size: 12px;
  color: #856404;
  line-height: 1.8;
}

/* Events Section */
.event-quick-info {
  background: white;
  border-radius: 10px;
  padding: 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  margin: 12px 0;
}

.event-quick-info h4 {
  color: #3B7DDD;
  font-size: 14px;
  margin-bottom: 10px;
  font-weight: 700;
}

.event-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px;
  margin: 6px 0;
  background: #F7FAFC;
  border-radius: 8px;
  font-size: 13px;
}

.event-item-icon {
  font-size: 20px;
  flex-shrink: 0;
}

.event-item-text {
  flex: 1;
  color: #2D3748;
}

.event-item-text strong {
  color: #3B7DDD;
  font-weight: 700;
}

.event-links {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 12px;
}

.event-link {
  padding: 10px 18px;
  background: linear-gradient(135deg, #3B7DDD, #2C5AA0);
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 700;
  box-shadow: 0 2px 8px rgba(59, 125, 221, 0.4);
  transition: all 0.2s;
  border: 2px solid white;
}

.event-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 125, 221, 0.6);
}

.last-updated {
  text-align: center;
  font-size: 11px;
  color: #718096;
  margin-top: 10px;
  font-style: italic;
}

/* Compact List Items */
.list-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px;
  margin-bottom: 6px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 3px solid #667eea;
  font-size: 13px;
  cursor: move;
  transition: all 0.2s;
}

.list-item:hover {
  background: #e9ecef;
  transform: translateX(3px);
}

.list-item.dragging {
  opacity: 0.5;
}

.list-item-sprite {
  width: 40px;
  height: 40px;
  flex-shrink: 0;
}

.list-item-content {
  flex: 1;
  min-width: 0;
  line-height: 1.4;
}

.list-item-name {
  font-weight: 700;
  color: #333;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 5px;
  flex-wrap: wrap;
}

.list-item-details {
  color: #666;
  font-size: 12px;
  margin-top: 2px;
}

.list-item-actions {
  display: flex;
  gap: 4px;
  flex-shrink: 0;
}

/* Type badges */
.type-badge {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 10px;
  font-size: 10px;
  font-weight: 700;
  color: white;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.type-normal { background: #A8A878; }
.type-fire { background: #F08030; }
.type-water { background: #6890F0; }
.type-electric { background: #F8D030; color: #333; }
.type-grass { background: #78C850; }
.type-ice { background: #98D8D8; }
.type-fighting { background: #C03028; }
.type-poison { background: #A040A0; }
.type-ground { background: #E0C068; }
.type-flying { background: #A890F0; }
.type-psychic { background: #F85888; }
.type-bug { background: #A8B820; }
.type-rock { background: #B8A038; }
.type-ghost { background: #705898; }
.type-dragon { background: #7038F8; }
.type-dark { background: #705848; }
.type-steel { background: #B8B8D0; }
.type-fairy { background: #EE99AC; }

/* Small badges */
.badge {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 8px;
  font-size: 10px;
  font-weight: 700;
  margin: 0 2px;
}

.badge-lvl50 { background: linear-gradient(135deg, #FFD700, #FFA500); color: #333; }
.badge-priority { background: linear-gradient(135deg, #FF6B6B, #FFE66D); color: #333; }
.badge-lucky { background: #FFD700; color: #333; }

/* Icons */
.icon {
  font-size: 14px;
  margin: 0 2px;
}

/* Buttons */
.btn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  cursor: pointer;
  font-weight: 600;
  margin: 4px;
  box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
  transition: all 0.2s;
}

.btn:active {
  transform: scale(0.95);
}

.btn-small {
  padding: 4px 8px;
  font-size: 11px;
}

.btn-danger {
  background: linear-gradient(135deg, #dc3545, #c82333);
}

.btn-success {
  background: linear-gradient(135deg, #28a745, #218838);
}

/* Progress bars */
.progress-bar {
  background: #e9ecef;
  border-radius: 8px;
  height: 16px;
  overflow: hidden;
  margin-top: 4px;
  width: 100%;
}

.progress-fill {
  background: linear-gradient(90deg, #667eea, #764ba2);
  height: 100%;
  transition: width 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 10px;
  font-weight: bold;
}

/* Candy counter */
.candy-controls {
  display: flex;
  align-items: center;
  gap: 4px;
  background: white;
  padding: 4px;
  border-radius: 6px;
}

.candy-value {
  min-width: 40px;
  text-align: center;
  font-weight: 700;
  font-size: 13px;
  color: #667eea;
}

/* Shiny Grid */
.shiny-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 10px;
  margin-top: 15px;
}

.shiny-card {
  text-align: center;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 8px;
  transition: all 0.2s;
  border: 2px solid transparent;
}

.shiny-card:hover {
  transform: scale(1.05);
  border-color: #FFD700;
}

.shiny-sprite {
  width: 50px;
  height: 50px;
}

.shiny-name {
  margin-top: 5px;
  font-size: 11px;
  font-weight: 600;
  color: #333;
}

.shiny-label {
  font-size: 9px;
  color: #FFD700;
  font-weight: bold;
  margin-top: 2px;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  z-index: 1000;
  overflow-y: auto;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: white;
  margin: 20px auto;
  padding: 20px;
  border-radius: 12px;
  max-width: 500px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.4);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #e9ecef;
}

.modal-header h2 {
  color: #667eea;
  font-size: 20px;
}

.modal-close {
  font-size: 28px;
  cursor: pointer;
  color: #999;
}

.modal-close:hover {
  color: #dc3545;
}

/* Forms */
.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: 600;
  color: #495057;
  font-size: 13px;
}

.form-control {
  width: 100%;
  padding: 10px;
  border: 2px solid #dee2e6;
  border-radius: 6px;
  font-size: 14px;
}

.form-control:focus {
  outline: none;
  border-color: #667eea;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  margin: 8px 0;
  cursor: pointer;
}

input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

/* Empty states */
.empty-state {
  text-align: center;
  padding: 30px 15px;
  color: #6c757d;
  font-size: 14px;
}

.loading {
  text-align: center;
  padding: 20px;
  color: #6c757d;
  font-size: 14px;
}

/* Drag handle */
.drag-handle {
  cursor: move;
  color: #999;
  font-size: 16px;
  padding: 0 4px;
}

@media (max-width: 600px) {
  .header h1 { font-size: 20px; }
  .trainer-info { font-size: 14px; }
  .list-item-details { font-size: 11px; }
  .candy-controls { flex-wrap: wrap; }
  .ai-helper-header { flex-direction: column; align-items: flex-start; }
}
</style>
</head>
<body>

<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>‚ö° POKEMON GO DASHBOARD</h1>
    <div class="trainer-info">MachoMankey ‚Ä¢ Level <span class="trainer-level">71</span></div>
    <div class="status-badge status-loading" id="syncStatus">üîÑ Syncing...</div>
  </div>

  <!-- Current Events -->
  <div class="section">
    <div class="section-header" onclick="toggleSection(this)">
      <h2>üìÖ Current Events</h2>
      <span class="collapse-icon">‚ñº</span>
    </div>
    <div class="section-content">
      <!-- AI Extraction Helper -->
      <div class="ai-helper-box">
        <div class="ai-helper-header">
          <div class="ai-helper-title">
            ü§ñ AI Event Extraction Helper
          </div>
          <button class="btn btn-small btn-success" onclick="copyPromptToClipboard()">
            üìã Copy Prompt
          </button>
        </div>
        <div class="ai-helper-text">
          Use this workflow to update events weekly (takes ~30 seconds):
        </div>
        <ol class="ai-helper-steps">
          <li>Click "Copy Prompt" button above</li>
          <li>Go to Claude.ai or ChatGPT</li>
          <li>Paste the prompt and upload your weekly event graphic</li>
          <li>Copy the AI's tab-separated output</li>
          <li>Paste into Google Sheets "CurrentEvents" tab (cell A1)</li>
          <li>Click "Refresh" below to see updates here</li>
        </ol>
      </div>
      
      <!-- Event Info from Google Sheets -->
      <div class="event-quick-info">
        <h4>üóìÔ∏è This Week's Events</h4>
        <div id="eventsList">
          <div class="loading">Loading events from Google Sheets...</div>
        </div>
      </div>
      
      <div class="event-links">
        <a href="https://leekduck.com/events/" target="_blank" class="event-link">ü¶Ü LeekDuck</a>
        <a href="https://pokemongohub.net/" target="_blank" class="event-link">üì∞ PoGo Hub</a>
        <a href="https://www.serebii.net/pokemongo/" target="_blank" class="event-link">üåê Serebii</a>
        <a href="https://www.g47ix.pro" target="_blank" class="event-link">üìä G47IX</a>
      </div>
      
      <div class="last-updated">
        <button class="btn btn-small" onclick="window.open(SHEET_URL, '_blank')">üìä Open Google Sheet</button>
        <button class="btn btn-small" onclick="loadAllData()">üîÑ Refresh Data</button>
      </div>
    </div>
  </div>

  <!-- Power-Up Priority -->
  <div class="section">
    <div class="section-header" onclick="toggleSection(this)">
      <h2>‚ö° Power-Up Priority</h2>
      <span class="collapse-icon">‚ñº</span>
    </div>
    <div class="section-content">
      <button class="btn btn-small" onclick="showAddPowerUpModal()">‚ûï Add Pokemon</button>
      <div id="powerUpContent" style="margin-top:10px;">
        <div class="loading">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Rare Candy Priority -->
  <div class="section">
    <div class="section-header" onclick="toggleSection(this)">
      <h2>üç¨ Rare Candy Priority</h2>
      <span class="collapse-icon">‚ñº</span>
    </div>
    <div class="section-content">
      <button class="btn btn-small" onclick="showAddCandyModal()">‚ûï Add Pokemon</button>
      <div id="rareCandyContent" style="margin-top:10px;">
        <div class="loading">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Lucky Trade Management -->
  <div class="section">
    <div class="section-header" onclick="toggleSection(this)">
      <h2>ü§ù Lucky Trade Management</h2>
      <span class="collapse-icon">‚ñº</span>
    </div>
    <div class="section-content">
      <h3 style="margin-bottom:10px; color: #667eea; font-size: 15px;">‚ú® Auto-Generated Wants</h3>
      <div id="autoLuckyWants">
        <div class="loading">Loading...</div>
      </div>
      
      <h3 style="margin:20px 0 10px; color: #667eea; font-size: 15px;">üìã Manual Trade Plans</h3>
      <button class="btn btn-small" onclick="showAddTradeModal()">‚ûï Add Trade Plan</button>
      <div id="tradePlansContent" style="margin-top:10px;">
        <div class="loading">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Shiny Dex Gaps -->
  <div class="section">
    <div class="section-header" onclick="toggleSection(this)">
      <h2>‚ú® Community Day Shiny Gaps</h2>
      <span class="collapse-icon">‚ñº</span>
    </div>
    <div class="section-content">
      <div style="margin-bottom: 15px;">
        <button class="btn btn-small" onclick="window.open(SHEET_URL, '_blank')">üìä Google Sheet</button>
        <button class="btn btn-small" onclick="loadAllData()">üîÑ Refresh</button>
      </div>
      <div id="shinyGapsContent">
        <div class="loading">Loading...</div>
      </div>
    </div>
  </div>
</div>

<!-- Modals -->
<div id="addPowerUpModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add Power-Up Priority</h2>
      <span class="modal-close" onclick="closeModal('addPowerUpModal')">&times;</span>
    </div>
    <form id="powerUpForm" onsubmit="savePowerUp(event)">
      <div class="form-group">
        <label>Pokemon Name *</label>
        <input type="text" class="form-control" id="puPokemon" required placeholder="e.g., Rayquaza">
      </div>
      <div class="form-group">
        <label>Type(s) (comma separated)</label>
        <input type="text" class="form-control" id="puTypes" placeholder="e.g., Dragon, Flying">
      </div>
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" id="puLucky"> ‚≠ê Is Lucky
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="puHasElite"> ‚úÖ Has Elite/Legacy Move
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="puNeedsElite"> ‚ùó Needs Elite/Legacy Move
        </label>
      </div>
      <div class="form-group">
        <label>Current Level *</label>
        <input type="number" class="form-control" id="puCurrentLevel" step="0.5" min="1" max="55" required>
      </div>
      <div class="form-group">
        <label>Target Level *</label>
        <input type="number" class="form-control" id="puTargetLevel" step="0.5" min="1" max="55" required>
      </div>
      <div class="form-group">
        <label>Role</label>
        <select class="form-control" id="puRole">
          <option>Raid</option>
          <option>GMAX</option>
          <option>Buddy</option>
          <option>Other</option>
        </select>
      </div>
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" id="puNeedLucky"> ü§ù Need Lucky Trade
        </label>
      </div>
      <div class="form-group">
        <label>Notes</label>
        <input type="text" class="form-control" id="puNotes" placeholder="Any additional info...">
      </div>
      <div class="form-group">
        <label>Priority (1-10)</label>
        <input type="number" class="form-control" id="puPriority" min="1" max="10" value="5">
      </div>
      <div class="form-group">
        <label>Status</label>
        <select class="form-control" id="puStatus">
          <option>To Do</option>
          <option>In Progress</option>
          <option>Done</option>
        </select>
      </div>
      <button type="submit" class="btn">üíæ Save</button>
    </form>
  </div>
</div>

<div id="addCandyModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add Rare Candy Priority</h2>
      <span class="modal-close" onclick="closeModal('addCandyModal')">&times;</span>
    </div>
    <form id="candyForm" onsubmit="saveCandy(event)">
      <div class="form-group">
        <label>Pokemon Name *</label>
        <input type="text" class="form-control" id="candyPokemon" required placeholder="e.g., Dialga">
      </div>
      <div class="form-group">
        <label>Current Candy *</label>
        <input type="number" class="form-control" id="candyCurrent" min="0" required>
      </div>
      <div class="form-group">
        <label>Target Candy *</label>
        <input type="number" class="form-control" id="candyTarget" min="0" required>
      </div>
      <div class="form-group">
        <label>Notes</label>
        <input type="text" class="form-control" id="candyNotes" placeholder="e.g., Adventure Effect, Legendary">
      </div>
      <button type="submit" class="btn">üíæ Save</button>
    </form>
  </div>
</div>

<div id="addTradeModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add Trade Plan</h2>
      <span class="modal-close" onclick="closeModal('addTradeModal')">&times;</span>
    </div>
    <form id="tradeForm" onsubmit="saveTrade(event)">
      <div class="form-group">
        <label>Friend Name *</label>
        <input type="text" class="form-control" id="tradeFriend" required>
      </div>
      <div class="form-group">
        <label>What They Want</label>
        <input type="text" class="form-control" id="tradeTheyWant">
      </div>
      <div class="form-group">
        <label>What You Want</label>
        <input type="text" class="form-control" id="tradeYouWant">
      </div>
      <div class="form-group">
        <label>Notes</label>
        <input type="text" class="form-control" id="tradeNotes">
      </div>
      <div class="form-group">
        <label>Status</label>
        <select class="form-control" id="tradeStatus">
          <option>Planned</option>
          <option>Waiting</option>
          <option>Complete</option>
        </select>
      </div>
      <button type="submit" class="btn">üíæ Save</button>
    </form>
  </div>
</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxeEnHA5MtsH2yIzsKOMB4Irz9R1Wqsj6SrcsZjjSEcF2McHJYQxpUhMbcFtXGf80ybIw/exec';
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1E9tGFWTFWHNkN6OheYwQCCuXDdz3oWAmbWTStoufz_w/edit';

let powerUpData = [];
let candyData = [];
let tradePlansData = [];
let shinyGapsData = [];
let eventsData = [];

const POKEMON_IDS = {
  'bulbasaur': 1, 'ivysaur': 2, 'venusaur': 3,
  'charmander': 4, 'charmeleon': 5, 'charizard': 6,
  'squirtle': 7, 'wartortle': 8, 'blastoise': 9,
  'weedle': 13, 'kakuna': 14, 'beedrill': 15,
  'pikachu': 25, 'raichu': 26,
  'sandshrew': 27, 'sandslash': 28,
  'clefairy': 35, 'clefable': 36,
  'abra': 63, 'kadabra': 64, 'alakazam': 65,
  'machop': 66, 'machoke': 67, 'machamp': 68,
  'geodude': 74, 'graveler': 75, 'golem': 76,
  'slowpoke': 79, 'slowbro': 80,
  'gastly': 92, 'haunter': 93, 'gengar': 94,
  'onix': 95,
  'rhyhorn': 111, 'rhydon': 112,
  'electabuzz': 125,
  'magmar': 126,
  'magikarp': 129, 'gyarados': 130,
  'eevee': 133,
  'porygon': 137,
  'dratini': 147, 'dragonair': 148, 'dragonite': 149,
  'mewtwo': 150, 'mew': 151,
  'chikorita': 152, 'bayleef': 153, 'meganium': 154,
  'cyndaquil': 155, 'quilava': 156, 'typhlosion': 157,
  'totodile': 158, 'croconaw': 159, 'feraligatr': 160,
  'mareep': 179, 'flaaffy': 180, 'ampharos': 181,
  'hoppip': 187, 'skiploom': 188, 'jumpluff': 189,
  'swinub': 220, 'piloswine': 221,
  'teddiursa': 216, 'ursaring': 217,
  'larvitar': 246, 'pupitar': 247, 'tyranitar': 248,
  'lugia': 249, 'ho-oh': 250,
  'treecko': 252, 'grovyle': 253, 'sceptile': 254,
  'torchic': 255, 'combusken': 256, 'blaziken': 257,
  'mudkip': 258, 'marshtomp': 259, 'swampert': 260,
  'seedot': 273, 'nuzleaf': 274, 'shiftry': 275,
  'ralts': 280, 'kirlia': 281, 'gardevoir': 282,
  'slakoth': 287, 'vigoroth': 288, 'slaking': 289,
  'roselia': 315, 'roserade': 407,
  'trapinch': 328, 'vibrava': 329, 'flygon': 330,
  'swablu': 333, 'altaria': 334,
  'duskull': 355, 'dusclops': 356,
  'bagon': 371, 'shelgon': 372, 'salamence': 373,
  'beldum': 374, 'metang': 375, 'metagross': 376,
  'regirock': 377, 'regice': 378, 'registeel': 379,
  'latias': 380, 'latios': 381,
  'kyogre': 382, 'groudon': 383, 'rayquaza': 384,
  'turtwig': 387, 'grotle': 388, 'torterra': 389,
  'chimchar': 390, 'monferno': 391, 'infernape': 392,
  'piplup': 393, 'prinplup': 394, 'empoleon': 395,
  'starly': 396, 'staravia': 397, 'staraptor': 398,
  'shinx': 403, 'luxio': 404, 'luxray': 405,
  'bronzor': 436, 'bronzong': 437,
  'gible': 443, 'gabite': 444, 'garchomp': 445,
  'uxie': 480, 'mesprit': 481, 'azelf': 482,
  'dialga': 483, 'palkia': 484,
  'heatran': 485,
  'giratina': 487,
  'cresselia': 488,
  'darkrai': 491,
  'shaymin': 492,
  'arceus': 493,
  'victini': 494,
  'snivy': 495, 'servine': 496, 'serperior': 497,
  'tepig': 498, 'pignite': 499, 'emboar': 500,
  'oshawott': 501, 'dewott': 502, 'samurott': 503,
  'roggenrola': 524, 'boldore': 525, 'gigalith': 526,
  'litwick': 607, 'lampent': 608, 'chandelure': 609,
  'deino': 633, 'zweilous': 634, 'hydreigon': 635,
  'cobalion': 638, 'terrakion': 639, 'virizion': 640,
  'tornadus': 641, 'thundurus': 642,
  'reshiram': 643, 'zekrom': 644,
  'landorus': 645,
  'kyurem': 646,
  'genesect': 649,
  'chespin': 650, 'quilladin': 651, 'chesnaught': 652,
  'fennekin': 653, 'braixen': 654, 'delphox': 655,
  'froakie': 656, 'frogadier': 657, 'greninja': 658,
  'fletchling': 661, 'fletchinder': 662, 'talonflame': 663,
  'xerneas': 716, 'yveltal': 717,
  'stufful': 759, 'bewear': 760
};

function getPokemonId(name) {
  const cleanName = name.toLowerCase().trim()
    .replace('alolan ', '').replace('galarian ', '').replace('hisuian ', '')
    .replace('shadow ', '').replace('mega ', '');
  return POKEMON_IDS[cleanName] || 25;
}

function getPokemonSprite(name) {
  return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${getPokemonId(name)}.png`;
}

// Copy AI extraction prompt to clipboard
function copyPromptToClipboard() {
  const prompt = `Extract this week's Pokemon Go events into a table with these exact columns: Icon, EventType, Description

Format as tab-separated values ready to paste into Google Sheets.

Use these guidelines:
- Icon: Use appropriate emoji (‚öîÔ∏è for raids, üí° for spotlight, üåü for events, üéØ for special hours, üèÜ for PvP, üî• for Max Monday, üìÜ for upcoming, etc.)
- EventType: Short category (Raids, Mega Raids, Event, Spotlight, PvP, Max Monday, GO Tour, etc.)
- Description: Concise details (Pokemon names, times, bonuses)

Example output format:
Icon	EventType	Description
‚öîÔ∏è	Raids	Necrozma (5‚òÖ) - starts Monday 10am, Raid Hour Wednesday 6pm
üí°	Spotlight	Wednesday 6pm - 2x Transfer Candy
üåü	Event	Lunar New Year (Tue 10am - Fri 8pm)

Please extract the events from this image now.`;

  // Try modern clipboard API first
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(prompt).then(() => {
      showCopyConfirmation();
    }).catch(err => {
      fallbackCopyToClipboard(prompt);
    });
  } else {
    fallbackCopyToClipboard(prompt);
  }
}

// Fallback copy method for older browsers
function fallbackCopyToClipboard(text) {
  const textArea = document.createElement('textarea');
  textArea.value = text;
  textArea.style.position = 'fixed';
  textArea.style.left = '-999999px';
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
    showCopyConfirmation();
  } catch (err) {
    alert('Copy failed. Please copy manually.');
  }
  
  document.body.removeChild(textArea);
}

// Show visual confirmation
function showCopyConfirmation() {
  const btn = event.target;
  const originalText = btn.innerHTML;
  const originalBg = btn.style.background;
  
  btn.innerHTML = '‚úÖ Copied!';
  btn.style.background = 'linear-gradient(135deg, #28a745, #218838)';
  
  setTimeout(() => {
    btn.innerHTML = originalText;
    btn.style.background = originalBg;
  }, 2000);
}

function renderEvents() {
  const container = document.getElementById('eventsList');
  
  if (eventsData.length === 0) {
    container.innerHTML = '<div class="empty-state" style="padding:15px;">No events loaded. Add to "CurrentEvents" tab in Google Sheets.</div>';
    return;
  }
  
  let html = '';
  eventsData.forEach(row => {
    const [icon, eventType, description] = row;
    if (icon && description) {
      html += `
        <div class="event-item">
          <div class="event-item-icon">${icon}</div>
          <div class="event-item-text">
            <strong>${eventType}:</strong> ${description}
          </div>
        </div>
      `;
    }
  });
  
  container.innerHTML = html || '<div class="empty-state" style="padding:15px;">Add events to Google Sheets "CurrentEvents" tab</div>';
}

function toggleSection(header) {
  header.classList.toggle('collapsed');
  header.nextElementSibling.classList.toggle('collapsed');
}

function showAddPowerUpModal() {
  document.getElementById('addPowerUpModal').style.display = 'block';
  document.getElementById('powerUpForm').reset();
}

function showAddCandyModal() {
  document.getElementById('addCandyModal').style.display = 'block';
  document.getElementById('candyForm').reset();
}

function showAddTradeModal() {
  document.getElementById('addTradeModal').style.display = 'block';
  document.getElementById('tradeForm').reset();
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

async function loadSheetData(sheetName) {
  try {
    const response = await fetch(`${SCRIPT_URL}?sheet=${sheetName}`);
    const result = await response.json();
    if (result.error) throw new Error(result.error);
    return result.data || [];
  } catch (error) {
    console.error(`Error loading ${sheetName}:`, error);
    return [];
  }
}

async function saveSheetData(sheetName, data) {
  try {
    const response = await fetch(SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify({ sheet: sheetName, values: data })
    });
    const result = await response.json();
    if (result.error) throw new Error(result.error);
    return true;
  } catch (error) {
    console.error(`Error saving ${sheetName}:`, error);
    alert('Save failed: ' + error.message);
    return false;
  }
}

async function loadAllData() {
  document.getElementById('syncStatus').textContent = 'üîÑ Syncing...';
  document.getElementById('syncStatus').className = 'status-badge status-loading';
  
  try {
    const [powerUp, candy, trades, shinyGaps, events] = await Promise.all([
      loadSheetData('PowerUpPriority'),
      loadSheetData('RareCandyPriority'),
      loadSheetData('LuckyTradePlans'),
      loadSheetData('CommunityDayShinies'),
      loadSheetData('CurrentEvents')
    ]);
    
    powerUpData = powerUp.length > 1 ? powerUp.slice(1) : [];
    candyData = candy.length > 1 ? candy.slice(1) : [];
    tradePlansData = trades.length > 1 ? trades.slice(1) : [];
    shinyGapsData = shinyGaps.length > 1 ? shinyGaps.slice(1) : [];
    eventsData = events.length > 1 ? events.slice(1) : [];
    
    renderAll();
    
    document.getElementById('syncStatus').textContent = '‚úÖ Synced';
    document.getElementById('syncStatus').className = 'status-badge status-connected';
  } catch (error) {
    document.getElementById('syncStatus').textContent = '‚ùå Sync Error';
    document.getElementById('syncStatus').className = 'status-badge status-disconnected';
  }
}

function renderAll() {
  renderEvents();
  renderPowerUp();
  renderCandy();
  renderTrades();
  renderShinyGaps();
}

// Drag and drop variables
let dragSrcEl = null;

function handleDragStart(e) {
  dragSrcEl = this;
  e.dataTransfer.effectAllowed = 'move';
  e.dataTransfer.setData('text/html', this.innerHTML);
  this.classList.add('dragging');
}

function handleDragOver(e) {
  if (e.preventDefault) e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
  return false;
}

function handleDragEnter(e) {
  this.classList.add('over');
}

function handleDragLeave(e) {
  this.classList.remove('over');
}

function handleDrop(e, dataArray, renderFunc, sheetName, headers) {
  if (e.stopPropagation) e.stopPropagation();
  
  if (dragSrcEl !== this) {
    const srcIndex = parseInt(dragSrcEl.getAttribute('data-index'));
    const destIndex = parseInt(this.getAttribute('data-index'));
    
    const item = dataArray[srcIndex];
    dataArray.splice(srcIndex, 1);
    dataArray.splice(destIndex, 0, item);
    
    saveSheetData(sheetName, [headers, ...dataArray]);
    renderFunc();
  }
  
  return false;
}

function handleDragEnd(e) {
  this.classList.remove('dragging');
  document.querySelectorAll('.list-item').forEach(item => item.classList.remove('over'));
}

function renderPowerUp() {
  const container = document.getElementById('powerUpContent');
  
  if (powerUpData.length === 0) {
    container.innerHTML = '<div class="empty-state">üìù No power-up priorities yet</div>';
    return;
  }
  
  const sorted = [...powerUpData].sort((a, b) => parseInt(a[12]) - parseInt(b[12]));
  
  let html = '';
  sorted.forEach((row, idx) => {
    const [pokemon, types, lucky, hasElite, needsElite, currentLevel, targetLevel, role, xlCandy, dust, needLucky, notes, priority, status] = row;
    
    const typeMarkup = types ? types.split(',').map(t => 
      `<span class="type-badge type-${t.trim().toLowerCase()}">${t.trim()}</span>`
    ).join('') : '';
    
    const badges = [];
    if (parseFloat(targetLevel) === 50) badges.push('<span class="badge badge-lvl50">50</span>');
    if (lucky === 'TRUE') badges.push('<span class="icon" title="Lucky">‚≠ê</span>');
    if (hasElite === 'TRUE') badges.push('<span class="icon" title="Has Elite">‚úÖ</span>');
    if (needsElite === 'TRUE') badges.push('<span class="icon" title="Needs Elite">‚ùó</span>');
    if (needLucky === 'TRUE') badges.push('<span class="icon" title="Need Lucky">ü§ù</span>');
    
    const actualIndex = powerUpData.indexOf(row);
    
    html += `
      <div class="list-item" draggable="true" data-index="${actualIndex}">
        <span class="drag-handle">‚ò∞</span>
        <img class="list-item-sprite" src="${getPokemonSprite(pokemon)}" onerror="this.src='https://via.placeholder.com/40'">
        <div class="list-item-content">
          <div class="list-item-name">
            ${pokemon} ${badges.join('')} <span class="badge badge-priority">#${priority}</span>
          </div>
          <div class="list-item-details">
            ${typeMarkup} Lv${currentLevel}‚Üí${targetLevel} ‚Ä¢ ${role} ‚Ä¢ ${status}
            ${notes ? ' ‚Ä¢ ' + notes : ''}
          </div>
        </div>
        <div class="list-item-actions">
          <button class="btn btn-small btn-danger" onclick="deletePowerUp(${actualIndex})">üóëÔ∏è</button>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
  
  // Add drag and drop listeners
  const items = container.querySelectorAll('.list-item');
  items.forEach(item => {
    item.addEventListener('dragstart', handleDragStart);
    item.addEventListener('dragenter', handleDragEnter);
    item.addEventListener('dragover', handleDragOver);
    item.addEventListener('dragleave', handleDragLeave);
    item.addEventListener('drop', function(e) {
      const headers = ['Pokemon', 'Types', 'Lucky', 'Has Elite', 'Needs Elite', 'Current Level', 'Target Level', 'Role', 'XL Candy', 'Stardust', 'Need Lucky', 'Notes', 'Priority', 'Status'];
      handleDrop.call(this, e, powerUpData, renderPowerUp, 'PowerUpPriority', headers);
    });
    item.addEventListener('dragend', handleDragEnd);
  });
}

function renderCandy() {
  const container = document.getElementById('rareCandyContent');
  
  if (candyData.length === 0) {
    container.innerHTML = '<div class="empty-state">üìù No rare candy priorities yet</div>';
    return;
  }
  
  let html = '';
  candyData.forEach((row, idx) => {
    const [pokemon, current, target, notes] = row;
    const needed = parseInt(target) - parseInt(current);
    const progress = Math.min((parseInt(current) / parseInt(target)) * 100, 100);
    
    html += `
      <div class="list-item" style="cursor: default; flex-wrap: wrap;">
        <img class="list-item-sprite" src="${getPokemonSprite(pokemon)}" onerror="this.src='https://via.placeholder.com/40'">
        <div class="list-item-content">
          <div class="list-item-name">${pokemon}</div>
          <div class="list-item-details">
            Need: ${needed} more ‚Ä¢ Target: ${target} ${notes ? ' ‚Ä¢ ' + notes : ''}
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${progress}%">${current}/${target}</div>
          </div>
        </div>
        <div class="candy-controls">
          <button class="btn btn-small" onclick="updateCandy(${idx}, -10)">-10</button>
          <button class="btn btn-small" onclick="updateCandy(${idx}, -1)">-1</button>
          <span class="candy-value">${current}</span>
          <button class="btn btn-small" onclick="updateCandy(${idx}, 1)">+1</button>
          <button class="btn btn-small" onclick="updateCandy(${idx}, 10)">+10</button>
        </div>
        <button class="btn btn-small btn-danger" style="margin-left:auto;" onclick="deleteCandy(${idx})">üóëÔ∏è</button>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function renderTrades() {
  const autoContainer = document.getElementById('autoLuckyWants');
  const plansContainer = document.getElementById('tradePlansContent');
  
  const autoWants = powerUpData.filter(row => row[10] === 'TRUE');
  
  if (autoWants.length === 0) {
    autoContainer.innerHTML = '<div class="empty-state">üí° Check "Need Lucky Trade" in Power-Up Priority</div>';
  } else {
    let html = '';
    autoWants.forEach(row => {
      const [pokemon, types, lucky, hasElite, needsElite, currentLevel, targetLevel, role, xlCandy, dust, needLucky, notes] = row;
      html += `
        <div class="list-item" style="border-left-color: #FFD700; cursor: default;">
          <img class="list-item-sprite" src="${getPokemonSprite(pokemon)}" onerror="this.src='https://via.placeholder.com/40'">
          <div class="list-item-content">
            <div class="list-item-name">${pokemon}</div>
            <div class="list-item-details">
              For: ${role} (Lv ${targetLevel})${notes ? ' ‚Ä¢ ' + notes : ''}
            </div>
          </div>
        </div>
      `;
    });
    autoContainer.innerHTML = html;
  }
  
  if (tradePlansData.length === 0) {
    plansContainer.innerHTML = '<div class="empty-state">üìù No manual trade plans yet</div>';
    return;
  }
  
  let html = '';
  tradePlansData.forEach((row, idx) => {
    const [friend, theyWant, youWant, notes, status] = row;
    
    html += `
      <div class="list-item" draggable="true" data-index="${idx}">
        <span class="drag-handle">‚ò∞</span>
        <span style="font-size:32px;">üë•</span>
        <div class="list-item-content">
          <div class="list-item-name">${friend}</div>
          <div class="list-item-details">
            They want: ${theyWant || 'TBD'} ‚Ä¢ You want: ${youWant || 'TBD'} ‚Ä¢ ${status}
            ${notes ? ' ‚Ä¢ ' + notes : ''}
          </div>
        </div>
        <button class="btn btn-small btn-danger" onclick="deleteTrade(${idx})">üóëÔ∏è</button>
      </div>
    `;
  });
  
  plansContainer.innerHTML = html;
  
  const items = plansContainer.querySelectorAll('.list-item');
  items.forEach(item => {
    item.addEventListener('dragstart', handleDragStart);
    item.addEventListener('dragenter', handleDragEnter);
    item.addEventListener('dragover', handleDragOver);
    item.addEventListener('dragleave', handleDragLeave);
    item.addEventListener('drop', function(e) {
      const headers = ['Friend', 'They Want', 'You Want', 'Notes', 'Status'];
      handleDrop.call(this, e, tradePlansData, renderTrades, 'LuckyTradePlans', headers);
    });
    item.addEventListener('dragend', handleDragEnd);
  });
}

function renderShinyGaps() {
  const container = document.getElementById('shinyGapsContent');
  
  if (shinyGapsData.length === 0) {
    container.innerHTML = '<div class="empty-state">üìù Update Google Sheet</div>';
    return;
  }
  
  const missing = shinyGapsData.filter(row => {
    const have = (row[1] || '').toString().toUpperCase();
    return have === 'N' || have === 'NO' || have === 'FALSE';
  });
  
  if (missing.length === 0) {
    container.innerHTML = '<div class="empty-state">üéâ All Community Day shinies!</div>';
    return;
  }
  
  let html = '<div class="shiny-grid">';
  missing.forEach(row => {
    html += `
      <div class="shiny-card">
        <img src="${getPokemonSprite(row[0])}" class="shiny-sprite" onerror="this.src='https://via.placeholder.com/50'">
        <div class="shiny-name">${row[0]}</div>
        <div class="shiny-label">‚≠ê Trade</div>
      </div>
    `;
  });
  html += '</div>';
  container.innerHTML = html;
}

async function savePowerUp(e) {
  e.preventDefault();
  
  const newRow = [
    document.getElementById('puPokemon').value,
    document.getElementById('puTypes').value,
    document.getElementById('puLucky').checked ? 'TRUE' : 'FALSE',
    document.getElementById('puHasElite').checked ? 'TRUE' : 'FALSE',
    document.getElementById('puNeedsElite').checked ? 'TRUE' : 'FALSE',
    document.getElementById('puCurrentLevel').value,
    document.getElementById('puTargetLevel').value,
    document.getElementById('puRole').value,
    '', '',
    document.getElementById('puNeedLucky').checked ? 'TRUE' : 'FALSE',
    document.getElementById('puNotes').value,
    document.getElementById('puPriority').value,
    document.getElementById('puStatus').value
  ];
  
  const headers = ['Pokemon', 'Types', 'Lucky', 'Has Elite', 'Needs Elite', 'Current Level', 'Target Level', 'Role', 'XL Candy', 'Stardust', 'Need Lucky', 'Notes', 'Priority', 'Status'];
  powerUpData.push(newRow);
  
  const success = await saveSheetData('PowerUpPriority', [headers, ...powerUpData]);
  if (success) {
    closeModal('addPowerUpModal');
    renderPowerUp();
    renderTrades();
  }
}

async function saveCandy(e) {
  e.preventDefault();
  
  const newRow = [
    document.getElementById('candyPokemon').value,
    document.getElementById('candyCurrent').value,
    document.getElementById('candyTarget').value,
    document.getElementById('candyNotes').value
  ];
  
  const headers = ['Pokemon', 'Current', 'Target', 'Notes'];
  candyData.push(newRow);
  
  const success = await saveSheetData('RareCandyPriority', [headers, ...candyData]);
  if (success) {
    closeModal('addCandyModal');
    renderCandy();
  }
}

async function saveTrade(e) {
  e.preventDefault();
  
  const newRow = [
    document.getElementById('tradeFriend').value,
    document.getElementById('tradeTheyWant').value,
    document.getElementById('tradeYouWant').value,
    document.getElementById('tradeNotes').value,
    document.getElementById('tradeStatus').value
  ];
  
  const headers = ['Friend', 'They Want', 'You Want', 'Notes', 'Status'];
  tradePlansData.push(newRow);
  
  const success = await saveSheetData('LuckyTradePlans', [headers, ...tradePlansData]);
  if (success) {
    closeModal('addTradeModal');
    renderTrades();
  }
}

async function updateCandy(idx, change) {
  const current = parseInt(candyData[idx][1]);
  candyData[idx][1] = Math.max(0, current + change).toString();
  
  const headers = ['Pokemon', 'Current', 'Target', 'Notes'];
  await saveSheetData('RareCandyPriority', [headers, ...candyData]);
  renderCandy();
}

async function deletePowerUp(idx) {
  if (!confirm('Delete this entry?')) return;
  powerUpData.splice(idx, 1);
  const headers = ['Pokemon', 'Types', 'Lucky', 'Has Elite', 'Needs Elite', 'Current Level', 'Target Level', 'Role', 'XL Candy', 'Stardust', 'Need Lucky', 'Notes', 'Priority', 'Status'];
  await saveSheetData('PowerUpPriority', [headers, ...powerUpData]);
  renderPowerUp();
  renderTrades();
}

async function deleteCandy(idx) {
  if (!confirm('Delete this entry?')) return;
  candyData.splice(idx, 1);
  const headers = ['Pokemon', 'Current', 'Target', 'Notes'];
  await saveSheetData('RareCandyPriority', [headers, ...candyData]);
  renderCandy();
}

async function deleteTrade(idx) {
  if (!confirm('Delete this entry?')) return;
  tradePlansData.splice(idx, 1);
  const headers = ['Friend', 'They Want', 'You Want', 'Notes', 'Status'];
  await saveSheetData('LuckyTradePlans', [headers, ...tradePlansData]);
  renderTrades();
}

window.onload = function() {
  loadAllData();
};

window.onclick = function(event) {
  if (event.target.classList.contains('modal')) {
    event.target.style.display = 'none';
  }
};
</script>

</body>
</html>
