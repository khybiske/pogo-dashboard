<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MachoMankey's PoGo Dashboard</title>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #f2f2f7; /* iOS grouped background */
  padding: 8px;
  min-height: 100vh;
  color: #1c1c1e;
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding-bottom: 40px;
}

/* HEADER */
.header {
  background: #3B7DDD;
  border-radius: 18px;
  padding: 20px 15px;
  text-align: center;
  box-shadow: 0 6px 20px rgba(59,125,221,0.35);
  margin-bottom: 18px;
}

.header h1 {
  color: white;
  font-size: 22px;
  font-weight: 800;
  letter-spacing: 0.5px;
}

.trainer-info {
  color: rgba(255,255,255,0.9);
  font-size: 14px;
  margin-top: 6px;
}

.trainer-level {
  color: #FFD700;
  font-weight: 700;
}

.status-badge {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 14px;
  font-size: 11px;
  font-weight: 700;
  margin-top: 8px;
}

.status-connected { background: #34C759; color: white; }
.status-disconnected { background: #FF3B30; color: white; }
.status-loading { background: #FFCC00; color: #1c1c1e; }

/* SECTIONS */
.section {
  background: white;
  border-radius: 14px;
  margin-bottom: 14px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  overflow: hidden;
  transition: transform 0.15s ease;
}

.section:hover {
  transform: translateY(-2px);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 16px;
  background: #3B7DDD;
  cursor: pointer;
  user-select: none;
}

.section-header h2 {
  color: white;
  font-size: 15px;
  font-weight: 700;
}

.collapse-icon {
  color: white;
  font-size: 18px;
  transition: transform 0.2s ease;
}

.section-header.collapsed .collapse-icon {
  transform: rotate(-90deg);
}

.section-content {
  padding: 16px;
}

.section-content.collapsed {
  display: none;
}

/* EVENTS */
.event-quick-info h4 {
  font-size: 14px;
  margin-bottom: 10px;
  color: #3B7DDD;
}

.event-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  margin: 6px 0;
  background: #f5f7fb;
  border-radius: 10px;
  font-size: 13px;
  transition: background 0.2s ease;
}

.event-item-live {
  background: #fff3cd;
  border-left: 4px solid #FF9500;
}

.event-item-icon {
  font-size: 20px;
}

.event-item-text strong {
  color: #3B7DDD;
}

.event-links {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 12px;
}

.event-link {
  padding: 8px 14px;
  background: #3B7DDD;
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  transition: opacity 0.2s ease;
}

.event-link:hover {
  opacity: 0.85;
}

.last-updated {
  margin-top: 12px;
  font-size: 12px;
  text-align: center;
}

/* BUTTONS */
.btn {
  background: #3B7DDD;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  font-size: 13px;
  cursor: pointer;
  font-weight: 600;
}

.btn-small {
  padding: 6px 10px;
  font-size: 12px;
}

.btn:active {
  transform: scale(0.97);
}

.loading, .empty-state {
  text-align: center;
  padding: 20px;
  color: #8e8e93;
  font-size: 13px;
}

@media (max-width: 600px) {
  .header h1 { font-size: 19px; }
}
</style>
</head>

<body>
<div class="container">

<div class="header">
  <h1>‚ö° POK√âMON GO DASHBOARD</h1>
  <div class="trainer-info">
    MachoMankey ‚Ä¢ Level <span class="trainer-level">71</span>
  </div>
  <div class="status-badge status-loading" id="syncStatus">üîÑ Syncing...</div>
</div>

<!-- CURRENT EVENTS -->
<div class="section">
  <div class="section-header" onclick="toggleSection(this)">
    <h2>üìÖ Current Events</h2>
    <span class="collapse-icon">‚ñº</span>
  </div>
  <div class="section-content">

    <div class="event-quick-info">
      <h4>üóìÔ∏è This Week</h4>
      <div id="eventsList">
        <div class="loading">Loading events...</div>
      </div>
    </div>

    <div class="event-links">
      <a href="https://leekduck.com/events/" target="_blank" class="event-link">ü¶Ü LeekDuck</a>
      <a href="https://pokemongohub.net/" target="_blank" class="event-link">üì∞ Hub</a>
      <a href="https://www.serebii.net/pokemongo/" target="_blank" class="event-link">üåê Serebii</a>
      <a href="https://www.g47ix.pro" target="_blank" class="event-link">üìä G47IX</a>
    </div>

    <div class="last-updated">
      <button class="btn btn-small" onclick="loadAllData()">üîÑ Refresh</button>
    </div>

  </div>
</div>

</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxeEnHA5MtsH2yIzsKOMB4Irz9R1Wqsj6SrcsZjjSEcF2McHJYQxpUhMbcFtXGf80ybIw/exec';

let eventsData = [];

function toggleSection(header) {
  header.classList.toggle('collapsed');
  header.nextElementSibling.classList.toggle('collapsed');
}

async function loadSheetData(sheetName) {
  const response = await fetch(`${SCRIPT_URL}?sheet=${sheetName}`);
  const result = await response.json();
  return result.data || [];
}

async function loadAllData() {
  document.getElementById('syncStatus').textContent = 'üîÑ Syncing...';
  document.getElementById('syncStatus').className = 'status-badge status-loading';

  try {
    const events = await loadSheetData('CurrentEvents');
    eventsData = events.length > 1 ? events.slice(1) : [];
    renderEvents();

    document.getElementById('syncStatus').textContent = '‚úÖ Synced';
    document.getElementById('syncStatus').className = 'status-badge status-connected';
  } catch (err) {
    document.getElementById('syncStatus').textContent = '‚ùå Sync Error';
    document.getElementById('syncStatus').className = 'status-badge status-disconnected';
  }
}

function renderEvents() {
  const container = document.getElementById('eventsList');

  if (eventsData.length === 0) {
    container.innerHTML = '<div class="empty-state">No events loaded.</div>';
    return;
  }

  const today = new Date();
  const weekday = today.toLocaleDateString('en-US', { weekday: 'long' }).toLowerCase();

  // Sort alphabetically by EventType for consistency
  const sorted = [...eventsData].sort((a, b) => a[1].localeCompare(b[1]));

  let html = '';

  sorted.forEach(row => {
    const [icon, type, description] = row;

    const descLower = description.toLowerCase();
    const isLive =
      descLower.includes('today') ||
      descLower.includes(weekday);

    html += `
      <div class="event-item ${isLive ? 'event-item-live' : ''}">
        <div class="event-item-icon">${icon}</div>
        <div class="event-item-text">
          <strong>${type}:</strong> ${description}
        </div>
      </div>
    `;
  });

  container.innerHTML = html;
}

window.onload = loadAllData;
</script>

</body>
</html>
